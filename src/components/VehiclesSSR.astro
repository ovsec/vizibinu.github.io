---
import * as all   from '../lib/blogs/sweden-foreign-population/realtime';
import Pbf from 'pbf';
const operator = 'sl';
const apiKey = 'a937a2cbe88341048c7e4268cc25ad43';


const protobufUpdate = async () => {
    console.log(all)
    // This is a reverse proxy to 
    // https://www.metrostlouis.org/RealTimeData/StlRealTimeVehicles.pb
    const url =
        `https://opendata.samtrafiken.se/gtfs-rt/${operator}/VehiclePositions.pb?key=${apiKey}`;
    let response = await fetch(url);

    if (response.ok) {
        // if HTTP-status is 200-299
        // get the response body (the method explained below)
        const bufferRes = await response.arrayBuffer();
        const pbf = new Pbf(new Uint8Array(bufferRes));
        const obj = all.FeedMessage.read(pbf);
        console.log(obj)
        return obj.entity;
    } else {
        console.error("error:", response.status);
    }
};

const data = await protobufUpdate();
---

<html>
<script is:inline src="/gtfs-realtime.browser.proto.ssr.js"></script>

<div>
    SSR Vehicles
    <div> Length: {data.length}</div>
</div>

</html>